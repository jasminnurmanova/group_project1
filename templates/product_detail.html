{% extends 'base.html' %}
{% block content %}
{% load static %}
    <!-- Product Detail Start -->
    <div class="container">
        <div class=" w-100 mt-5 ">
            <div class="row shadow-sm ">
                <div class="col-4 p-3">
    <div id="carouselExampleCaptions"
         class="carousel slide"
         data-bs-ride="carousel">

        <div class="carousel-inner">
            {% for picture in product.images.all %}
                {% if forloop.first %}
                    <div class="carousel-item active">
                        <img src="{{ picture.image.url }}"
                             class="d-block w-100"
                             height="270">
                    </div>
                {% else %}
                    <div class="carousel-item">
                        <img src="{{ picture.image.url }}"
                             class="d-block w-100"
                             height="270">
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <!-- âœ… CONTROLS -->
        <button class="carousel-control-prev"
                type="button"
                data-bs-target="#carouselExampleCaptions"
                data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>

        <button class="carousel-control-next"
                type="button"
                data-bs-target="#carouselExampleCaptions"
                data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>

    </div>
</div>

                <div class="col-7 p-5 ">
                    <h4>{{ product.title }}</h4>
                    <p class="test-muted"><a href="{% url 'users:profile' product.author.username %}">@{{ product.author.username }}</a> | 25.01.2023</p>
                    <p > {{ product.description|safe }} </p>
                    <div class="contact mt-4 ">
                        {% if request.user == product.author %}
                            <a class="btn btn-warning" href="{% url 'products:update' product.id %}">Edit details</a>
                        {% endif %}

                        <a class="btn btn-primary" href="mailto:{{customuser.email}}">Email</a>
                        <a class="btn btn-primary" href="tel:{{customuser.phone_number}}">Call</a>
                        <a class="btn btn-primary" href="http://t.me/@{{customuser.tg_username}}">Telegram</a>
                    </div>
                </div>
            </div>
            <div class="row ">
                <div class="col-8 mt-5" >
                    <h6  >In This Category</h6>
                    <div class="d-flex flex-wrap justify-content-between">
                        {% load static %}
{% for i in product.category.product_set.all %}
{% if i.id != product.id %}
    <div class="card border border-0 shadow-sm d-inline-block m-1 mt-3"
         style="width: 14rem;">

        {% if i.images.exists %}
            <img height="190"
                 class="card-img-top"
                 src="{{ i.images.first.image.url }}"
                 alt="">
        {% else %}
            <img height="190"
                 class="card-img-top"
                 src="{% static 'images/14pro2.jfif' %}"
                 alt="">
        {% endif %}

        <div class="card-body">
            <h6 class="card-title">{{ i.title }}</h6>
            <span class="card-text">{{ i.price }}</span>

            <div class="buttons d-flex justify-content-between">
                <i class="bi bi-bookmark-fill"></i>
                <a href="{% url 'products:detail' i.id %}"
                   class="btn btn-outline-primary">
                    Details
                </a>
            </div>
        </div>
    </div>
      {% endif %}
{% endfor %}

                </div>
                <div class="col-4 mt-5 shadow-sm ">
                    <h6 class="pt-2" >Add comment</h6>
                    <form action="{% url 'products:comment_new' product.id %}" method="post" class="input-group">{% csrf_token %}
                        <input class="form-control" name="body" type="text" placeholder="Type your comment..." aria-describedby="'button-addon" >
                        <button class="btn btn-outline-success" type="submit" id="button-addon">Send</button>
                    </form>
                    <hr>
                    <h6>Comments</h6>
                    {% for comment in product.comment_set.all %}
                    <small class="text-muted" >@{{comment.author}}| {{comment.date}}</small>
                    <p>{{ comment.body }}
                        {% if request.user == comment.author %}
                        <small><a href="{% url 'products:comment_delete' product.id comment.id %}">Delete</a></small>
                        {% endif %}
                    </p>
                    {% endfor %}
                </div>
            </div>


    </div>
    </div>
    <!-- Product Detail End -->

{% endblock content %}